<!-- viewer.html CORRETO -->
<!DOCTYPE html>
<html>
<body>
<canvas id="tela"></canvas>

<script>
// Pega room da URL
const urlParams = new URLSearchParams(window.location.search);
const roomId = urlParams.get('room');

// Conecta WebSocket
const ws = new WebSocket('ws://localhost:8765');
const canvas = document.getElementById('tela');
const ctx = canvas.getContext('2d');

ws.onopen = () => {
    // Envia configuração inicial
    ws.send(JSON.stringify({
        type: 'viewer',
        room_id: roomId
    }));
    console.log("Conectado como viewer");
};

ws.onmessage = (event) => {
    const data = JSON.parse(event.data);
    
    if (data.type === 'frame') {
        const img = new Image();
        img.onload = () => {
            canvas.width = data.width;
            canvas.height = data.height;
            ctx.drawImage(img, 0, 0);
        };
        img.src = 'data:image/jpeg;base64,' + data.data;
    }
};
</script>
</body>
</html>
